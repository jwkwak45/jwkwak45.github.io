<html>
    <head>

        <style>

        body{

                    margin: 0px;
                }

        .tl{
            height: 35px;
            margin: 5px;
            
        }

        #addlistbutton{
           
            position: fixed;
            left: 5px;
            bottom: 5%;
            


        }
        
       

        .count{
            position: absolute;
            right: 5%;
            color: gray;

        }
        
        #taskview{

            display: none;
        }

        .tasks{
                 height: 50px;
                 margin: 10px;
                 border-bottom: 1px solid #afafaf;

             }

                #header{

                    background-color: green;
                    
                    height: 100px;


                }

                #backtolist{

                    position: absolute; left: 3%; top:3%

                }

                #detailmenu{
                    position: absolute; right: 3%; top:3%
                }

                #addtaskbutton{
                    width: 50px;
                    height: 50px;
                    position: absolute; right: 5%; bottom:5%
                }

            #title{

                font-size: 15pt;
                position: absolute; left: 20%; top: 5%


            }
                


        
        </style>
      
        
        
    </head>
    <body>
        
        <section id = "main">
        <section id = "list">
        

        </section>

        <div id ="addlistbutton", style="color: #5166af; background: white; width:100% " >
            + 새 목록 
        </div>
    </section>

    <section id= "taskview">
            <section id= "header">

            <div id="menu" style="color:white"> <span id= "backtolist"> &#9776;  </span>   <span id=detailmenu> &#8942; </span></div>
            

            </section>

            <section id = "tlist">


            </section>

            <img src="https://jwkwak45.github.io/todo/source/plus.svg" id = "addtaskbutton" alt="addtaskbutton">
            </section>
           
            
    <script
    src="https://code.jquery.com/jquery-3.2.1.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>
    <script>
    

    var groupListURL = "https://jwkwak45.github.io/todo/json/groupList.json";
    var groupAddURL = "https://jwkwak45.github.io/todo/json/groupAdd.json";
    var taskListURL = "https://jwkwak45.github.io/todo/json/taskList.json";
    var taskAddURL = "https://jwkwak45.github.io/todo/json/taskAdd.json";
    var Render = function(data,status){
        console.log(data);
        $.each(data.data,function(i,n){
        if (n.icon == "sun"){
          
         n.icon = "<img src = " + '"https://jwkwak45.github.io/todo/source/sun.svg"' +"width = '20px'; height = '20px';"+ "/>"
        };
        if (n.icon == "check"){
            n.icon = "<img src = " + '"https://jwkwak45.github.io/todo/source/check.svg"' +"width = '20px'; height = '20px';"+ "/>"
        };

        if (n.icon == "&#8942;&#9776;"){
            n.icon = '<font color = "'+ n.color +'">' + n.icon + "</font>"
        }

        if (n.count == "0"){
            n.count = ""
        }

       
        $("#list").append( '<div class = "tl" idvalue='+n.id +'>'+ n.icon + "&nbsp;&nbsp;"+ n.name  +'<span class = "count">'+ n.count + "</span>  </div>");
       
       
        
    });

    }

   

    $.get(groupListURL, Render);


    $("#addlistbutton").click(function(e){

       var newname = prompt("새 목록")

    $.get(groupAddURL , {"name":newname},Render);
        

    });


    $("#list").on('click',".tl",function(e){

        $("#main").css("display","none")
        $("#taskview").css("display","block")
        var idvalue = $(this).attr("idvalue")
       $.get(groupListURL,function(data,status){
           var listname = "";
           var icon = "";
           var color = "";
            $.each(data.data,function(i,n){
                if(n.id == idvalue){
                    listname = n.name
                    icon = n.icon
                    color = n.color;
                }            
            });

    var taskRender = function(data,status){
        console.log(data);
        $.each(data.data,function(i,n){
            var done = "";
            var myday = "";
            var duedate = "";
            var repeat = "";
            var alarm = "";
            var note = "";

            if(n.id == idvalue){
                console.log(n.id)
                console.log(idvalue)

            if(n.done == false){
                done = "<img src = " + '"https://jwkwak45.github.io/todo/source/check_undone.svg"' +'class = "done" '+" width = '20px'; height = '20px';"+ "/>";

            }
            else {
                done = "<img src = " + '"https://jwkwak45.github.io/todo/source/check_done.svg"' +'class = "done" ' +"width = '20px'; height = '20px';"+ "/>";
            }

        if(n.myday != null){
            myday =  "<img src = " + '"https://jwkwak45.github.io/todo/source/sun_gray.svg"' +"width = '20px'; height = '20px';"+ "/>"+ '<span style="color:#6465ea; font-size:9pt ">오늘 할 일 </span>';
        }

        if(n.duedate != null){


            if(n.repeat != null){
                repeat = "↺";
            }

        }

        if(n.fre_alert != null){
            alarm ='<span style="color:gray"> • </span>'+ "<img src = " + '"https://jwkwak45.github.io/todo/source/alarmclock.svg"' +"width = '15px'; height = '15px';"+ "/>";
        }

        if(n.note != null){

            note =  '<span style="color:gray"> • </span>'+"<img src = " + '"https://jwkwak45.github.io/todo/source/note.svg"' +"width = '15px'; height = '15px';"+ "/>";
        }



        $("#tlist").append( '<div class="tasks">'+ done + "&nbsp;&nbsp;"+ n.name  +'<br><span class = "detail">'+ myday +alarm+note+ "</span>  </div>");
            
        } 
        
    });

    
   $("#addtaskbutton").click(function(e){

       var newname = prompt("새 할 일")

    $.get(taskAddURL , {"name":newname, "id":idvalue},taskRender);
    ///현재는 id 값 때문에 3번에만 추가 됩니다!!!
        

    });

   
    }
    $("#header").append( '<div id = "title">'+ icon + "&nbsp;&nbsp;"+ listname + "</div>");
    $("#header").css("background-color",color);


           $.get(taskListURL,taskRender);

        });

    


        
        
        console.log( idvalue)

        $("#tlist").on('click',".done",function(e){
       var undone = "https://jwkwak45.github.io/todo/source/check_undone.svg";
       var done = "https://jwkwak45.github.io/todo/source/check_done.svg";
       if($(this).attr("src") == undone)
       {

        $.get(taskListURL , {"id":idvalue , "done":"undone"})

        $(this).attr("src",done);

       }

       else
       {

        $.get(taskListURL , {"id":idvalue , "done":"undone"});

        $(this).attr("src", undone);

       }



   });

    });

   $("#backtolist").click(function(e){
        $("#main").css("display","block")
        $("#taskview").css("display","none")
        $("#title").remove();
        $("#tlist").empty();

   });


  


    </script>
    </body>
    </html>
    